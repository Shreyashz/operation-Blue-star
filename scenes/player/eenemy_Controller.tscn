[gd_scene load_steps=18 format=3 uid="uid://ux21v11i48uj"]

[ext_resource type="Script" path="res://assets/scripts/player/enemy_controller.gd" id="1_48d61"]
[ext_resource type="Script" path="res://assets/scripts/player/en_combat.gd" id="2_s438m"]
[ext_resource type="Script" path="res://assets/scripts/player/HurtBox.gd" id="3_4g12p"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_jkuo1"]

[sub_resource type="CapsuleMesh" id="CapsuleMesh_48d61"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_s438m"]

[sub_resource type="BoxMesh" id="BoxMesh_48d61"]
size = Vector3(0.5, 0.25, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_48d61"]
albedo_color = Color(0.0286666, 0, 0.86, 1)
metallic = 0.5
roughness = 0.0

[sub_resource type="CylinderShape3D" id="CylinderShape3D_48d61"]
height = 1.0
radius = 6.0

[sub_resource type="CylinderShape3D" id="CylinderShape3D_s438m"]
height = 1.0
radius = 3.0

[sub_resource type="Animation" id="Animation_4g12p"]
resource_name = "flyAround"
step = 0.1

[sub_resource type="Animation" id="Animation_8ik7v"]
length = 0.001

[sub_resource type="AnimationLibrary" id="AnimationLibrary_8ik7v"]
_data = {
"RESET": SubResource("Animation_8ik7v"),
"flyAround": SubResource("Animation_4g12p")
}

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_s438m"]
bg_color = Color(0.14, 0.14, 0.14, 0.784314)
corner_radius_top_left = 5
corner_radius_top_right = 5
corner_radius_bottom_right = 5
corner_radius_bottom_left = 5

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_4g12p"]
bg_color = Color(1, 0.354179, 0.139425, 1)
corner_radius_top_left = 5
corner_radius_top_right = 5
corner_radius_bottom_right = 5
corner_radius_bottom_left = 5

[sub_resource type="ViewportTexture" id="ViewportTexture_s438m"]
viewport_path = NodePath("UI element/SubViewport")

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_48d61"]
radius = 0.570814
height = 2.12896

[node name="EenemyController" type="CharacterBody3D" node_paths=PackedStringArray("nav_agent", "cast_shape", "timer", "RayCheckWall", "progressBar")]
script = ExtResource("1_48d61")
nav_agent = NodePath("NavigationAgent3D")
cast_shape = NodePath("Follow range")
timer = NodePath("Timer")
RayCheckWall = NodePath("RayCast3D")
progressBar = NodePath("UI element/SubViewport/ProgressBar")
chase_speed = 4.5
wander_speed = 2.5
safeDist = 0.05

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_jkuo1")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("CapsuleMesh_48d61")
surface_material_override/0 = SubResource("StandardMaterial3D_s438m")

[node name="NavigationAgent3D" type="NavigationAgent3D" parent="."]
path_height_offset = 0.2
avoidance_enabled = true

[node name="MeshInstance3D2" type="MeshInstance3D" parent="."]
transform = Transform3D(-4.37114e-08, 0, 1, 0, 1, 0, -1, 0, -4.37114e-08, 0, 0.5, -0.3)
mesh = SubResource("BoxMesh_48d61")
surface_material_override/0 = SubResource("StandardMaterial3D_48d61")

[node name="Follow range" type="ShapeCast3D" parent="."]
shape = SubResource("CylinderShape3D_48d61")
target_position = Vector3(0, 0, 0)
collision_mask = 4

[node name="Timer" type="Timer" parent="."]
wait_time = 5.0
autostart = true

[node name="RayCast3D" type="RayCast3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.866025, 0.5, 0, -0.5, 0.866025, 0, -0.18, 0)
target_position = Vector3(0, 0, -1.25)
collision_mask = 8

[node name="Combat" type="Node3D" parent="." node_paths=PackedStringArray("rayshape", "animationPlayer", "kickTimer", "BigOneTimer")]
script = ExtResource("2_s438m")
rayshape = NodePath("Attack Range")
animationPlayer = NodePath("Combat Animation")
kickTimer = NodePath("Fly around timer")
BigOneTimer = NodePath("Big one Timer")

[node name="Attack Range" type="ShapeCast3D" parent="Combat"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.8, 0)
shape = SubResource("CylinderShape3D_s438m")

[node name="Big one Timer" type="Timer" parent="Combat"]
one_shot = true

[node name="Fly around timer" type="Timer" parent="Combat"]
one_shot = true

[node name="Combat Animation" type="AnimationPlayer" parent="Combat"]
libraries = {
"": SubResource("AnimationLibrary_8ik7v")
}

[node name="UI element" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.2, 0)

[node name="SubViewport" type="SubViewport" parent="UI element"]
transparent_bg = true
handle_input_locally = false
size = Vector2i(256, 256)
render_target_update_mode = 4

[node name="ProgressBar" type="ProgressBar" parent="UI element/SubViewport"]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -63.5
offset_top = -13.5
offset_right = 63.5
offset_bottom = 2.5
grow_horizontal = 2
grow_vertical = 2
size_flags_stretch_ratio = 0.5
theme_override_styles/background = SubResource("StyleBoxFlat_s438m")
theme_override_styles/fill = SubResource("StyleBoxFlat_4g12p")
value = 1.0
rounded = true
allow_greater = true

[node name="Sprite3D" type="Sprite3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.3, 0)
billboard = 1
texture = SubResource("ViewportTexture_s438m")

[node name="HurtBox" type="Area3D" parent="."]
collision_layer = 0
collision_mask = 16
script = ExtResource("3_4g12p")

[node name="CollisionShape3D" type="CollisionShape3D" parent="HurtBox"]
shape = SubResource("CapsuleShape3D_48d61")

[connection signal="timeout" from="Timer" to="." method="randomize_direction"]
